<div class="auth-page">
  <div class="auth-card auth-card-wide">
    <h1 class="auth-title">Edit post</h1>
    <p class="auth-subtitle">Update your blog post.</p>

    <% if @post.errors.any? %>
      <div class="auth-errors" role="alert">
        <p class="auth-errors-title"><%= pluralize(@post.errors.count, "error") %> prevented saving:</p>
        <ul>
          <% @post.errors.full_messages.each do |msg| %>
            <li><%= msg %></li>
          <% end %>
        </ul>
      </div>
    <% end %>

    <%= form_with model: @post, url: post_path(@post), method: :patch, local: true, class: "auth-form", multipart: true do |f| %>
      <div class="auth-field">
        <%= f.label :title, "Title" %>
        <%= f.text_field :title, placeholder: "Post title", class: "auth-input", autofocus: true %>
      </div>
      <div class="auth-field">
        <%= f.label :body, "Body" %>
        <%= f.text_area :body, placeholder: "Write your post...", class: "auth-input auth-textarea", rows: 10 %>
      </div>
      <div class="auth-field">
        <%= f.label :images, "Images" %>
        <p class="post-form-images-hint">Current images (check "Remove" to delete). Use "Add more images" to attach additional images without removing existing ones.</p>
        <% if @post.display_images.any? %>
          <div class="post-form-current-images">
            <% @post.display_images.each do |img| %>
              <% blob_id = blob_id_for_removal(img) %>
              <% next if blob_id.blank? %>
              <div class="post-form-current-image">
                <%= image_tag img, class: "post-form-image-preview", alt: "" %>
                <label class="post-form-remove-image">
                  <%= check_box_tag "post[remove_image_ids][]", blob_id, false, id: "remove_image_#{blob_id}" %>
                  Remove this image
                </label>
              </div>
            <% end %>
          </div>
        <% end %>
        <p class="post-form-add-more">Add more images:</p>
        <%= f.file_field :images, accept: "image/*", multiple: true, class: "auth-input" %>
      </div>
      <div class="auth-field">
        <span class="auth-field-label">Visibility</span>
        <div class="visibility-options">
          <label class="visibility-option">
            <%= f.radio_button :visibility, "public" %>
            <span>Public</span> — visible to everyone on the blog feed
          </label>
          <label class="visibility-option">
            <%= f.radio_button :visibility, "private" %>
            <span>Private</span> — visible only to you
          </label>
        </div>
      </div>
      <div class="auth-actions">
        <%= f.submit "Save changes", class: "auth-submit" %>
      </div>
    <% end %>

    <p class="auth-footer">
      <%= link_to "Back to blog", root_path %>
    </p>
  </div>
</div>
